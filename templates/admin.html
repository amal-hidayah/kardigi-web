{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    
    <div class="mb-4 d-flex justify-content-between align-items-center">
        <div>
            <h1 class="fw-bold display-6" style="color: var(--primary-navy);">Dashboard Admin</h1>
            <p class="text-muted mb-0">Kelola referensi website dan portofolio KARDIGI dengan mudah.</p>
        </div>
        <a href="/logout" class="btn btn-outline-danger btn-sm rounded-pill px-3">
            Logout üö™
        </a>
    </div>

    <div class="mb-5">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="row g-4">
        
        <!-- Upload Portfolio Website -->
        <div class="col-lg-6">
            <div class="admin-card h-100">
                <div class="admin-card-header">
                    <h5 class="admin-card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--accent-orange)" class="bi bi-globe" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m7.5-6.923c-.67.204-1.335.82-1.887 1.855A8 8 0 0 0 5.145 4H7.5zM4.09 4a9.3 9.3 0 0 1 .64-1.539 7 7 0 0 1 .597-.933A7.03 7.03 0 0 0 2.255 4zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a7 7 0 0 0-.656 2.5zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5zM8.5 5v2.5h2.99a12.5 12.5 0 0 0-.337-2.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5zM5.145 12q.208.58.468 1.068c.552 1.035 1.218 1.65 1.887 1.855V12zm.182 2.472a7 7 0 0 1-.597-.933A9.3 9.3 0 0 1 4.09 12H2.255a7 7 0 0 0 3.072 2.472M3.82 11a13.7 13.7 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5zm6.853 3.472A7 7 0 0 0 13.745 12H11.91a9.3 9.3 0 0 1-.64 1.539 7 7 0 0 1-.597.933M8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855q.26-.487.468-1.068zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.7 13.7 0 0 1-.312 2.5m2.802-3.5a7 7 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7 7 0 0 0-3.072-2.472c.218.284.418.598.597.933M10.855 4a8 8 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4z"/></svg>
                        Upload Portfolio Website
                    </h5>
                </div>
                <div class="p-4 pt-0">
                    <form action="{{ url_for('upload_portfolio_website') }}" method="POST" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">Judul Website</label>
                            <input type="text" name="title" class="form-control form-control-admin" placeholder="Cth: Website Toko Online Fashion" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">Deskripsi (Optional)</label>
                            <textarea name="description" class="form-control form-control-admin" rows="2" placeholder="Deskripsi singkat..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">Screenshot Website</label>
                            <input type="file" name="image" class="form-control form-control-admin" accept="image/*" required>
                            <div class="form-text small">Format: JPG, PNG. Maks 2MB</div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label small fw-bold text-muted">Link Demo (Optional)</label>
                            <input type="url" name="demo_link" class="form-control form-control-admin" placeholder="https://example.com">
                        </div>
                        <button type="submit" class="btn btn-orange w-100 py-2 shadow-sm">
                            <i class="fas fa-upload me-2"></i> Upload Website
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Upload Portfolio CV -->
        <div class="col-lg-6">
            <div class="admin-card h-100">
                <div class="admin-card-header">
                    <h5 class="admin-card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="var(--accent-orange)" class="bi bi-file-person" viewBox="0 0 16 16"><path d="M12 1a1 1 0 0 1 1 1v10.755S12 11 8 11s-5 1.755-5 1.755V2a1 1 0 0 1 1-1zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/><path d="M8 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/></svg>
                        Upload Portfolio CV
                    </h5>
                </div>
                <div class="p-4 pt-0">
                    <form action="{{ url_for('upload_portfolio_cv') }}" method="POST" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">Nama/Judul CV</label>
                            <input type="text" name="title" class="form-control form-control-admin" placeholder="Cth: CV Minimalist - John Doe" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">Deskripsi (Optional)</label>
                            <textarea name="description" class="form-control form-control-admin" rows="2" placeholder="Deskripsi singkat..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="form-label small fw-bold text-muted">Preview CV</label>
                            <input type="file" name="image" class="form-control form-control-admin" accept="image/*" required>
                            <div class="form-text small">Format: JPG, PNG. Maks 2MB</div>
                        </div>
                        <button type="submit" class="btn btn-orange w-100 py-2 shadow-sm">
                            <i class="fas fa-upload me-2"></i> Upload CV
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Portfolio Website Table -->
        <div class="col-lg-6">
            <div class="admin-card h-100">
                <div class="admin-card-header d-flex justify-content-between align-items-center">
                    <h5 class="admin-card-title">
                        <i class="fas fa-globe me-2"></i> Portfolio Website
                    </h5>
                    <span class="badge bg-primary">{{ portfolio_websites|length }}</span>
                </div>
                <div class="p-4 pt-0 table-responsive">
                    <table class="table table-admin table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="small fw-bold">Thumbnail</th>
                                <th class="small fw-bold">Judul</th>
                                <th class="small fw-bold text-end">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if portfolio_websites %}
                                {% for item in portfolio_websites %}
                                <tr>
                                    <td>
                                        <img src="{{ url_for('static', filename='uploads/' + item.image) }}" 
                                             alt="{{ item.title }}" 
                                             class="rounded" 
                                             style="width: 60px; height: 45px; object-fit: cover;">
                                    </td>
                                    <td>
                                        <div class="fw-bold small">{{ item.title }}</div>
                                        {% if item.description %}
                                        <div class="text-muted" style="font-size: 0.7rem;">{{ item.description[:40] }}...</div>
                                        {% endif %}
                                    </td>
                                    <td class="text-end">
                                        <a href="{{ url_for('delete_portfolio_website', id=item.id) }}" 
                                           class="btn btn-sm btn-outline-danger rounded-circle p-1" 
                                           onclick="return confirm('Yakin ingin menghapus?');">
                                            üóëÔ∏è
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="3" class="text-center py-4 text-muted small">
                                        Belum ada portfolio website
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Portfolio CV Table -->
        <div class="col-lg-6">
            <div class="admin-card h-100">
                <div class="admin-card-header d-flex justify-content-between align-items-center">
                    <h5 class="admin-card-title">
                        <i class="fas fa-file-alt me-2"></i> Portfolio CV
                    </h5>
                    <span class="badge bg-danger">{{ portfolio_cvs|length }}</span>
                </div>
                <div class="p-4 pt-0 table-responsive">
                    <table class="table table-admin table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="small fw-bold">Thumbnail</th>
                                <th class="small fw-bold">Judul</th>
                                <th class="small fw-bold text-end">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if portfolio_cvs %}
                                {% for item in portfolio_cvs %}
                                <tr>
                                    <td>
                                        <img src="{{ url_for('static', filename='uploads/' + item.image) }}" 
                                             alt="{{ item.title }}" 
                                             class="rounded" 
                                             style="width: 45px; height: 60px; object-fit: cover;">
                                    </td>
                                    <td>
                                        <div class="fw-bold small">{{ item.title }}</div>
                                        {% if item.description %}
                                        <div class="text-muted" style="font-size: 0.7rem;">{{ item.description[:40] }}...</div>
                                        {% endif %}
                                    </td>
                                    <td class="text-end">
                                        <a href="{{ url_for('delete_portfolio_cv', id=item.id) }}" 
                                           class="btn btn-sm btn-outline-danger rounded-circle p-1" 
                                           onclick="return confirm('Yakin ingin menghapus?');">
                                            üóëÔ∏è
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="3" class="text-center py-4 text-muted small">
                                        Belum ada portfolio CV
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Blog Management Section -->
        <div class="col-12" id="blog">
            <div class="admin-card">
                <div class="admin-card-header d-flex justify-content-between align-items-center">
                    <h5 class="admin-card-title">
                        <i class="fas fa-blog me-2"></i> Kelola Blog Posts
                    </h5>
                    <button class="btn btn-sm btn-primary rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#addBlogModal">
                        <i class="fas fa-plus me-1"></i> Tambah Artikel
                    </button>
                </div>
                <div class="p-4 pt-0 table-responsive">
                    <table class="table table-admin table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="small fw-bold">Gambar</th>
                                <th class="small fw-bold">Judul</th>
                                <th class="small fw-bold">Status</th>
                                <th class="small fw-bold">Tanggal</th>
                                <th class="small fw-bold text-end">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if blog_posts %}
                                {% for post in blog_posts %}
                                <tr>
                                    <td>
                                        {% if post.image %}
                                        <img src="{{ url_for('static', filename='uploads/' + post.image) }}" 
                                             alt="{{ post.title }}" 
                                             class="rounded" 
                                             style="width: 80px; height: 50px; object-fit: cover;">
                                        {% else %}
                                        <div class="bg-secondary rounded d-flex align-items-center justify-content-center" 
                                             style="width: 80px; height: 50px;">
                                            <i class="fas fa-image text-white"></i>
                                        </div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="fw-bold small">{{ post.title }}</div>
                                        <div class="text-muted" style="font-size: 0.7rem;">
                                            <i class="fas fa-link"></i> /blog/{{ post.slug }}
                                        </div>
                                    </td>
                                    <td>
                                        {% if post.published %}
                                        <span class="badge bg-success">Published</span>
                                        {% else %}
                                        <span class="badge bg-secondary">Draft</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ post.created_at.strftime('%d %b %Y') }}</small>
                                    </td>
                                    <td class="text-end">
                                        <a href="{{ url_for('blog_detail', slug=post.slug) }}" 
                                           target="_blank"
                                           class="btn btn-sm btn-outline-primary rounded-circle p-1" 
                                           title="Lihat">
                                            üëÅÔ∏è
                                        </a>
                                        <button class="btn btn-sm btn-outline-warning rounded-circle p-1" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#editBlogModal{{ post.id }}"
                                                title="Edit">
                                            ‚úèÔ∏è
                                        </button>
                                        <a href="{{ url_for('delete_blog_post', id=post.id) }}" 
                                           class="btn btn-sm btn-outline-danger rounded-circle p-1" 
                                           onclick="return confirm('Yakin ingin menghapus artikel ini?');"
                                           title="Hapus">
                                            üóëÔ∏è
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center py-4 text-muted small">
                                        Belum ada artikel blog
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Modal: Add Blog Post -->
<div class="modal fade" id="addBlogModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus-circle me-2"></i>Tambah Artikel Blog</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('add_blog_post') }}" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Judul Artikel *</label>
                        <input type="text" name="title" class="form-control" required>
                        <small class="form-text text-muted">URL slug akan dibuat otomatis dari judul</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Konten Artikel *</label>
                        <textarea name="content" class="form-control" rows="8" required></textarea>
                        <small class="form-text text-muted">Gunakan HTML untuk format (h2, p, ul, strong, em, dll)</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Excerpt / Ringkasan</label>
                        <textarea name="excerpt" class="form-control" rows="2" maxlength="300"></textarea>
                        <small class="form-text text-muted">Ringkasan singkat untuk preview (maks 300 karakter)</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Gambar Featured</label>
                        <input type="file" name="image" class="form-control" accept="image/*">
                        <small class="form-text text-muted">Ukuran rekomendasi: 1200x800px</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Meta Description (SEO)</label>
                        <textarea name="meta_description" class="form-control" rows="2" maxlength="160"></textarea>
                        <small class="form-text text-muted">Deskripsi untuk search engine (maks 160 karakter)</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Meta Keywords (SEO)</label>
                        <input type="text" name="meta_keywords" class="form-control">
                        <small class="form-text text-muted">Pisahkan dengan koma (cth: website, desain, SEO)</small>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="published" id="publishedAdd" checked>
                        <label class="form-check-label" for="publishedAdd">
                            Publish artikel (tampilkan di website)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Simpan Artikel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Edit Blog Posts -->
{% for post in blog_posts %}
<div class="modal fade" id="editBlogModal{{ post.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Artikel Blog</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('edit_blog_post', id=post.id) }}" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Judul Artikel *</label>
                        <input type="text" name="title" class="form-control" value="{{ post.title }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Konten Artikel *</label>
                        <textarea name="content" class="form-control" rows="8" required>{{ post.content }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Excerpt / Ringkasan</label>
                        <textarea name="excerpt" class="form-control" rows="2" maxlength="300">{{ post.excerpt or '' }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Gambar Featured</label>
                        {% if post.image %}
                        <div class="mb-2">
                            <img src="{{ url_for('static', filename='uploads/' + post.image) }}" 
                                 alt="{{ post.title }}" 
                                 class="img-thumbnail" 
                                 style="max-height: 150px;">
                            <div class="small text-muted mt-1">Gambar saat ini: {{ post.image }}</div>
                        </div>
                        {% endif %}
                        <input type="file" name="image" class="form-control" accept="image/*">
                        <small class="form-text text-muted">Kosongkan jika tidak ingin mengubah gambar</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Meta Description (SEO)</label>
                        <textarea name="meta_description" class="form-control" rows="2" maxlength="160">{{ post.meta_description or '' }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Meta Keywords (SEO)</label>
                        <input type="text" name="meta_keywords" class="form-control" value="{{ post.meta_keywords or '' }}">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="published" id="publishedEdit{{ post.id }}" {% if post.published %}checked{% endif %}>
                        <label class="form-check-label" for="publishedEdit{{ post.id }}">
                            Publish artikel (tampilkan di website)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save me-2"></i>Update Artikel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{% endblock %}

{% extends 'base.html' %}

{% block content %}

<!-- Hero section removed -->

<!-- PORTFOLIO WEBSITE SECTION -->
<section class="py-5" style="background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);">
    <div class="container py-4">
        <div class="mb-4">
            <div class="row align-items-center g-3">
                <div class="col-md-6">
                    <h3 class="fw-bold mb-2" style="color: var(--primary-navy);">Menampilkan semua design website</h3>
                </div>
                <div class="col-md-6">
                    <div class="d-flex justify-content-md-end">
                        <div class="input-group search-group" style="max-width: 360px;">
                            <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                            <input type="text" id="searchDesignInput" class="form-control" placeholder="Cari design website..." aria-label="Cari design website">
                            <button class="btn btn-outline-secondary" id="clearSearchBtn" type="button" aria-label="Bersihkan">Bersihkan</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <span id="resultSummary" class="text-muted small">Menampilkan semua design website</span>
            </div>
        </div>
        
        <!-- Portfolio Grid -->
        <div class="row g-4 portfolio-grid" id="portfolioGrid">
            {% if portfolio %}
                {% for item in portfolio %}
                <div class="col-12 col-sm-6 col-lg-4 portfolio-item reveal" data-index="{{ loop.index }}" data-title="{{ item.title|lower }}" data-desc="{{ (item.description or '')|lower }}">
                    <div class="card border-0 h-100 portfolio-card" style="border-radius: 16px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.08);">
                        <div class="position-relative portfolio-img-wrapper" style="padding-top: 65%; overflow: hidden;">
                            <img src="{{ url_for('static', filename='uploads/' + item.image) }}" 
                                 alt="{{ item.title }}"
                                 class="position-absolute top-0 start-0 w-100 h-100"
                                 style="object-fit: cover; transition: transform 0.4s ease;">
                            
                            <!-- Overlay sederhana: hitamkan dan tampilkan tombol + nama -->
                            <div class="portfolio-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" 
                                 style="background: rgba(15, 23, 42, 0); opacity: 0;">
                                <div class="overlay-content text-center px-3">
                                    <h6 class="text-white fw-bold mb-3 overlay-title">{{ item.title }}</h6>
                                    <div class="overlay-buttons">
                                        <a href="{% if item.demo_link %}{{ item.demo_link }}{% else %}#{% endif %}" 
                                           target="{% if item.demo_link %}_blank{% else %}_self{% endif %}"
                                           class="btn btn-light rounded-pill fw-bold portfolio-btn">
                                            <i class="fas fa-eye me-2"></i>Lihat Demo
                                        </a>
                                        <a href="https://wa.me/6289509951772?text=Halo,%20saya%20mau%20pilih%20template%20{{ item.title }}" 
                                           target="_blank"
                                           class="btn btn-orange rounded-pill fw-bold portfolio-btn">
                                            <i class="fas fa-check-circle me-2"></i>Pilih Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-3">
                            <h6 class="fw-bold mb-0 text-center" style="color: var(--primary-navy); font-size: 0.9rem;">{{ item.title }}</h6>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="col-12 text-center">
                    <p class="text-muted">Belum ada portfolio yang ditambahkan</p>
                </div>
            {% endif %}
        </div>
        
        <div id="emptyState" class="text-center py-5 d-none">
            <h5 class="fw-bold" style="color: var(--primary-navy);">Tidak ada hasil</h5>
            <p class="text-muted mb-3">Coba kata kunci lain atau kosongkan pencarian.</p>
            <button class="btn btn-outline-secondary rounded-pill" id="resetSearchBtn">Tampilkan semua</button>
        </div>
        
        {% if portfolio_pagination and portfolio_pagination.pages > 1 %}
        <nav class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item {% if not portfolio_pagination.has_prev %}disabled{% endif %}">
                    <a class="page-link rounded-pill" href="{{ url_for('jasa_website', page=portfolio_pagination.prev_num) }}">Sebelumnya</a>
                </li>
                
                {% set page = portfolio_pagination.page %}
                {% set pages = portfolio_pagination.pages %}
                {% set start = 1 if page - 2 < 1 else page - 2 %}
                {% set end = pages if page + 2 > pages else page + 2 %}
                
                {% if start > 1 %}
                    <li class="page-item"><a class="page-link rounded-pill" href="{{ url_for('jasa_website', page=1) }}">1</a></li>
                    {% if start > 2 %}<li class="page-item disabled"><span class="page-link rounded-pill">...</span></li>{% endif %}
                {% endif %}
                
                {% for p in range(start, end + 1) %}
                    <li class="page-item {% if p == page %}active{% endif %}">
                        <a class="page-link rounded-pill" href="{{ url_for('jasa_website', page=p) }}">{{ p }}</a>
                    </li>
                {% endfor %}
                
                {% if end < pages %}
                    {% if end < pages - 1 %}<li class="page-item disabled"><span class="page-link rounded-pill">...</span></li>{% endif %}
                    <li class="page-item"><a class="page-link rounded-pill" href="{{ url_for('jasa_website', page=pages) }}">{{ pages }}</a></li>
                {% endif %}
                
                <li class="page-item {% if not portfolio_pagination.has_next %}disabled{% endif %}">
                    <a class="page-link rounded-pill" href="{{ url_for('jasa_website', page=portfolio_pagination.next_num) }}">Berikutnya</a>
                </li>
            </ul>
        </nav>
        {% endif %}
        
    </div>
</section>

<!-- Paket & Harga section removed -->

<!-- Problem section removed -->

<!-- Cara kerja section removed -->

<!-- CTA final removed -->

<style>
/* Mobile: hide items beyond first 3 */
@media (max-width: 767px) {
    .portfolio-item.mobile-hidden {
        display: none !important;
    }
    
    .portfolio-item.mobile-hidden.show-mobile {
        display: block !important;
    }
}

/* Portfolio hover animation */
.portfolio-card:hover .portfolio-img-wrapper img { transform: none; }

.portfolio-card:hover .portfolio-overlay { background: rgba(15, 23, 42, 0.85) !important; opacity: 1 !important; }

.portfolio-card:hover .card-body { display: none; }
.portfolio-card.active .card-body { display: none; }

/* Overlay transition + proportional buttons */
.portfolio-overlay {
    transition: opacity 0.5s ease, background-color 0.5s ease;
}
.overlay-content { transform: translateY(8px); opacity: 0; transition: transform 0.5s ease, opacity 0.5s ease; }
.portfolio-card:hover .overlay-content, .portfolio-card.active .overlay-content { transform: translateY(0); opacity: 1; }
.overlay-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    width: 100%;
    max-width: 360px;
    margin: 0 auto;
}
.portfolio-overlay .portfolio-btn { 
    border-radius: 999px; 
    padding: 8px 16px !important; 
    min-height: 40px;
    width: auto;
    min-width: 120px;
    font-size: 0.9rem !important; 
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.18) !important;
}
.overlay-title { font-size: 1rem; }

/* Pagination style */
.pagination .page-link {
    color: var(--primary-navy);
    border: 1px solid #e5e7eb;
    padding: 8px 14px;
}
.pagination .page-item.active .page-link {
    background: #1f2937;
    color: #fff;
    border-color: #1f2937;
}
.pagination .page-item.disabled .page-link {
    color: #9ca3af;
    pointer-events: none;
}

/* Mobile touch interaction */
@media (max-width: 768px) {
    .portfolio-card {
        -webkit-tap-highlight-color: transparent;
    }
    
    /* Larger title font for mobile full-width cards */
    .portfolio-card .card-body h6 {
        font-size: 1.1rem !important;
    }
    
    .overlay-buttons { flex-direction: column; max-width: 280px; }
    .portfolio-card .portfolio-btn { width: 100%; font-size: 0.95rem !important; min-height: 44px; }
    
    /* Add tap hint for mobile */
    .portfolio-img-wrapper::before {
        content: 'Tap untuk opsi';
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(251, 191, 36, 0.95);
        color: #0f172a;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 0.85rem;
        font-weight: 600;
        z-index: 2;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        animation: pulse 2s ease-in-out infinite;
    }
    
    /* Hide hint when overlay is active */
    .portfolio-card.active .portfolio-img-wrapper::before {
        display: none;
    }
    
    /* Show overlay when card has 'active' class */
    .portfolio-card.active .portfolio-overlay {
        background: rgba(15, 23, 42, 0.85) !important;
        opacity: 1 !important;
    }
    .portfolio-card.active .portfolio-img-wrapper img { transform: none; }
}

/* Button hover effects */
.btn-orange {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    border: none;
    transition: all 0.3s ease;
}

.btn-orange:hover {
    background: linear-gradient(135deg, #d97706, #b45309);
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5) !important;
}

.btn-light:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3) !important;
}

/* Search UX */
.search-group .form-control:focus {
    box-shadow: 0 0 0 0.25rem rgba(245, 158, 11, 0.25);
    border-color: #f59e0b;
}

@media (max-width: 768px) {
    .search-group { width: 100%; }
}

/* Pulse animation for mobile hint */
@keyframes pulse {
    0%, 100% {
        transform: translateX(-50%) scale(1);
        opacity: 1;
    }
    50% {
        transform: translateX(-50%) scale(1.05);
        opacity: 0.9;
    }
}
</style>

<script>
let visibleCount = 6;
let mobileExpanded = false;

// Toggle mobile portfolio show more/less
function toggleMobilePortfolio() {}

function loadMorePortfolio() {
    const items = document.querySelectorAll('.portfolio-item.d-none');
    const itemsToShow = Array.from(items).slice(0, 6);
    
    itemsToShow.forEach(item => {
        item.classList.remove('d-none');
    });
    
    visibleCount += itemsToShow.length;
    
    // Hide button if no more items
    if (document.querySelectorAll('.portfolio-item.d-none').length === 0) {
        document.getElementById('loadMoreBtn').style.display = 'none';
    }
}

// Client-side search only
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchDesignInput');
    const resultSummary = document.getElementById('resultSummary');
    const emptyState = document.getElementById('emptyState');
    const clearBtn = document.getElementById('clearSearchBtn');
    const resetBtn = document.getElementById('resetSearchBtn');
    let searchTerm = '';
    let debounceTimer = null;
    
    function applyFilters() {
        const items = document.querySelectorAll('.portfolio-item');
        const term = searchTerm.trim().toLowerCase();
        let visibleCount = 0;
        
        items.forEach(item => {
            const title = (item.dataset.title || '').toLowerCase();
            const desc = (item.dataset.desc || '').toLowerCase();
            const match = !term || title.includes(term) || desc.includes(term);
            item.style.display = match ? '' : 'none';
            if (match) visibleCount++;
        });
        
        const total = items.length;
        if (term) {
            resultSummary.textContent = `Menampilkan ${visibleCount} design untuk “${searchTerm}”`;
        } else {
            resultSummary.textContent = `Menampilkan semua design website (${total})`;
        }
        
        if (visibleCount === 0) {
            emptyState.classList.remove('d-none');
        } else {
            emptyState.classList.add('d-none');
        }
    }
    
    searchInput.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            searchTerm = searchInput.value;
            applyFilters();
        }, 200);
    });
    
    if (clearBtn) {
        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            searchTerm = '';
            applyFilters();
            searchInput.focus();
        });
    }
    
    if (resetBtn) {
        resetBtn.addEventListener('click', () => {
            searchInput.value = '';
            searchTerm = '';
            applyFilters();
            searchInput.focus();
        });
    }
});

// Mobile portfolio interaction: Click to show overlay first, then click buttons
if (window.innerWidth <= 768) {
    document.addEventListener('DOMContentLoaded', function() {
        const portfolioCards = document.querySelectorAll('.portfolio-card');
        
        portfolioCards.forEach(card => {
            const overlay = card.querySelector('.portfolio-overlay');
            const buttons = card.querySelectorAll('.portfolio-btn');
            
            // Click on card (image area) to show overlay
            card.addEventListener('click', function(e) {
                // If clicking on a button, let it work normally
                if (e.target.closest('.portfolio-btn')) {
                    return;
                }
                
                // Toggle active state
                const isActive = card.classList.contains('active');
                
                // Remove active from all other cards
                portfolioCards.forEach(c => c.classList.remove('active'));
                
                // Toggle this card
                if (!isActive) {
                    card.classList.add('active');
                    e.preventDefault();
                    e.stopPropagation();
                }
            });
            
            // Prevent overlay from closing when clicking inside overlay
            if (overlay) {
                overlay.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });
        
        // Close overlay when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.portfolio-card')) {
                portfolioCards.forEach(card => card.classList.remove('active'));
            }
        });
    });
}
</script>

{% endblock %}
